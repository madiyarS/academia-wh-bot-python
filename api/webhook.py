import os
import json
import requests
from datetime import datetime, timedelta
from http.server import BaseHTTPRequestHandler
import re
from typing import Dict, Optional

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
GREEN_INSTANCE = os.environ.get('GREEN_INSTANCE')
GREEN_TOKEN = os.environ.get('GREEN_TOKEN')
TELEGRAM_TOKEN = os.environ.get('TELEGRAM_TOKEN')
ADMIN_TELEGRAM = os.environ.get('ADMIN_TELEGRAM')
UPSTASH_REDIS_REST_URL = os.environ.get('UPSTASH_REDIS_REST_URL')
UPSTASH_REDIS_REST_TOKEN = os.environ.get('UPSTASH_REDIS_REST_TOKEN')

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Upstash Redis
redis_client = None
if UPSTASH_REDIS_REST_URL and UPSTASH_REDIS_REST_TOKEN:
    try:
        from upstash_redis import Redis
        redis_client = Redis(url=UPSTASH_REDIS_REST_URL, token=UPSTASH_REDIS_REST_TOKEN)
        print("‚úÖ Upstash Redis connected")
    except Exception as e:
        print(f"‚ùå Redis connection error: {e}")

SESSION_TIMEOUT_SECONDS = 24 * 60 * 60

# –¢–µ–∫—Å—Ç—ã –Ω–∞ –¥–≤—É—Ö —è–∑—ã–∫–∞—Ö
t = {
    "ru": {
        "start": "üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ ¬´–ê–∫–∞–¥–µ–º–∏—é¬ª\n\nüì± –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ—Ç —á–∞—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –≤–∞–º–∏. –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã.",
        "lang": "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –æ–±—â–µ–Ω–∏—è:",
        "kg": "üè´ –î–µ—Ç—Å–∫–∏–π —Å–∞–¥",
        "school": "üéì –ù–∞—á–∞–ª—å–Ω–∞—è —à–∫–æ–ª–∞",
        "back": "‚óÄÔ∏è –ù–∞–∑–∞–¥",
        "restart": "üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ",
        "menu": "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É:",
        "items": [
            "üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
            "üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ –æ–ø–ª–∞—Ç–∞",
            "üìù –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ",
            "‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã",
            "üçΩ –ü–∏—Ç–∞–Ω–∏–µ",
            "üé® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è",
            "üìû –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ"
        ],
        "notUnderstood": "–ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω—è–ª. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –Ω–∏–∂–µ üëá",
        "operator": "üìû –î–ª—è —Å–≤—è–∑–∏ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –ø–æ–∑–≤–æ–Ω–∏—Ç–µ:\n+7 701 573 1794\n\n–ò–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É, –∏ –º—ã –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–º.",
        "info_kg": """üè´ –î–æ—à–∫–æ–ª—å–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è ¬´–ê–∫–∞–¥–µ–º–∏—è¬ª

üìç –ê–¥—Ä–µ—Å: –≥. –ê—Å—Ç–∞–Ω–∞, —É–ª. –®—ã–≥–∞–Ω–∞–∫, 7
üìû –¢–µ–ª–µ—Ñ–æ–Ω—ã: +7 701 573 1794, +7 708 685 3959

üë∂ –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã: –æ—Ç 2 –¥–æ 3 –ª–µ—Ç, –æ—Ç 3 –¥–æ 4 –ª–µ—Ç, –æ—Ç 4 –¥–æ 5 –ª–µ—Ç, –æ—Ç 5 –¥–æ 6, –≥—Ä—É–ø–ø–∞ 6+ (–ø—Ä–µ–¥—à–∫–æ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞)
üó£ –Ø–∑—ã–∫–∏: –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –∏ —Ä—É—Å—Å–∫–∏–π
üìö –ú–µ—Ç–æ–¥–∏–∫–∏: –æ–±—â–µ–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –†–ö, –û—Ä—Ñ-–ø–µ–¥–∞–≥–æ–≥–∏–∫–∞, ¬´–ó–µ–ª–µ–Ω—ã–π –¥–µ—Ç—Å–∫–∏–π —Å–∞–¥¬ª

üë• –í –≥—Ä—É–ø–ø–∞—Ö –¥–æ 25 –¥–µ—Ç–µ–π (1 –≤–æ—Å–ø–∏—Ç–∞—Ç–µ–ª—å + 1 –ø–æ–º–æ—â–Ω–∏–∫)
‚úÖ –ï—Å—Ç—å: –ª–æ–≥–æ–ø–µ–¥, –ø—Å–∏—Ö–æ–ª–æ–≥, –º–µ–¥—Å–µ—Å—Ç—Ä–∞, –≤—Ä–∞—á-–ø–µ–¥–∏–∞—Ç—Ä
üç≥ –°–≤–æ—è –∫—É—Ö–Ω—è, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∫–∏ —É –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã
üìπ –ö–∞–º–µ—Ä—ã –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è –µ—Å—Ç—å (–æ–Ω–ª–∞–π–Ω-–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω)""",
        "cost_kg": """üí∞ –ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –ø–ª–∞—Ç–∞: 215 000 —Ç–µ–Ω–≥–µ
üí≥ –í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å: 150 000 —Ç–µ–Ω–≥–µ (—Ä–∞–∑–æ–≤—ã–π)

‚úÖ –í —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Ö–æ–¥–∏—Ç:
‚Ä¢ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–∑–≤–∏—Ç–∏—è —Ä–µ–±–µ–Ω–∫–∞
‚Ä¢ 5-—Ä–∞–∑–æ–≤–æ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ
‚Ä¢ –ë–æ–ª–µ–µ 20 —Ä–∞–∑–≤–∏–≤–∞—é—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π –≤ –Ω–µ–¥–µ–ª—é
‚Ä¢ –ü–ª–∞–≤–∞–Ω–∏–µ
‚Ä¢ –í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

üí∏ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã, –≤—ã–µ–∑–¥–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, —É—á–∞—Å—Ç–∏–µ –≤ –∫–æ–Ω–∫—É—Ä—Å–∞—Ö, –ª–∏—á–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫

üéÅ –°–∫–∏–¥–∫–∏:
‚Ä¢ –í—Ç–æ—Ä–æ–π —Ä–µ–±—ë–Ω–æ–∫ ‚Äî –º–∏–Ω—É—Å 10 000 —Ç–µ–Ω–≥–µ
‚Ä¢ –û–ø–ª–∞—Ç–∞ –∑–∞ –≥–æ–¥ –≤–ø–µ—Ä—ë–¥ ‚Äî 5%

üí≥ –û–ø–ª–∞—Ç–∞: —Ç–æ–ª—å–∫–æ –±–µ–∑–Ω–∞–ª–∏—á–Ω–∞—è
üìû –ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –æ–ø–ª–∞—Ç—ã: +7 701 577-41-88 (–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è)""",
        "enroll_kg": """üìù –ü—Ä–∏–Ω–∏–º–∞–µ–º –¥–µ—Ç–µ–π —Å 2 –ª–µ—Ç
üìÖ –ù–∞–±–æ—Ä –∫—Ä—É–≥–ª—ã–π –≥–æ–¥
‚è± –ê–¥–∞–ø—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –ø–æ–¥ –ø–∞—Ç—Ä–æ–Ω–∞–∂–µ–º –ø—Å–∏—Ö–æ–ª–æ–≥–∞ –∏ –ø–µ–¥–∏–∞—Ç—Ä–∞

üìÑ –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:
1Ô∏è‚É£ –ó–∞—è–≤–ª–µ–Ω–∏–µ –∏ –∞–Ω–∫–µ—Ç–∞ (–∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ—Ñ–∏—Å–µ)
2Ô∏è‚É£ –ö–æ–ø–∏—è —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏
3Ô∏è‚É£ –ö–æ–ø–∏—è —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è
4Ô∏è‚É£ –§–æ—Ç–æ 3√ó4 ‚Äî 2 —à—Ç.
5Ô∏è‚É£ –ü–∞—Å–ø–æ—Ä—Ç –∑–¥–æ—Ä–æ–≤—å—è + —Ñ–æ—Ä–º–∞ ‚Ññ063
6Ô∏è‚É£ –î–æ–≥–æ–≤–æ—Ä –∏ –ø—Ä–∞–≤–∏–ª–∞ (–ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ—Ñ–∏—Å–µ)

üéØ –•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏—é? –ù–∞–ø–∏—à–∏—Ç–µ ¬´–î–∞¬ª""",
        "regime_kg": """‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 08:00 ‚Äì 18:00 (–ø–Ω‚Äì–ø—Ç)
üìÖ –í—ã—Ö–æ–¥–Ω—ã–µ: —Å—É–±–±–æ—Ç–∞, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
‚úÖ –ü–æ—Å–µ—â–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ

‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫–∏:
‚Ä¢ –ü–æ –±–æ–ª–µ–∑–Ω–∏ (—Å–æ —Å–ø—Ä–∞–≤–∫–æ–π) ‚Äî –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç 50% –ø–æ –ø–∏—Ç–∞–Ω–∏—é
‚Ä¢ –û—Ç–ø—É—Å–∫ ‚Äî 50% —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü, –¥–∞–ª–µ–µ –ø–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞""",
        "food_kg": """üçΩ 5-—Ä–∞–∑–æ–≤–æ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ
üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∏–º –Ω–∞ —Å–≤–æ–µ–π –∫—É—Ö–Ω–µ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∞ –∏ –¥–∏–µ—Ç–æ–ª–æ–≥–∞
ü•ó –£—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–π
üìã –í–Ω–µ–¥—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–∏—Ç–∞–Ω–∏—è""",
        "circles_kg": """üé® –ö—Ä—É–∂–∫–∏ –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º –∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –æ–ø–ª–∞—Ç—É:

üèä –ü–ª–∞–≤–∞–Ω–∏–µ
üó£ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
üé® –ê—Ä—Ç-—Å—Ç—É–¥–∏—è
üíÉ –°–ø–æ—Ä—Ç–∏–≤–Ω–æ-–±–∞–ª—å–Ω—ã–µ —Ç–∞–Ω—Ü—ã ¬´S Dance¬ª
ü•ã –ö–∞—Ä–∞—Ç—ç
ü§∏ –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞
üëÑ –õ–æ–≥–æ–ø–µ–¥
üßÆ –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞
‚ôü –®–∞—Ö–º–∞—Ç—ã
üé≠ –ê–∫—Ç—ë—Ä—Å–∫–æ–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ
üé§ –í–æ–∫–∞–ª –∏ —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ
üß† –ü—Å–∏—Ö–æ–ª–æ–≥
üí™ –õ–§–ö –∏ –º–∞—Å—Å–∞–∂

üéâ –ü—Ä–∞–∑–¥–Ω–∏–∫–∏ (–¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è –¥–µ—Ç–µ–π) –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è –ø–æ –∑–∞–ø—Ä–æ—Å—É —Ä–æ–¥–∏—Ç–µ–ª—è –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ–º—É –ø—Ä–∞–π—Å—É –∫–æ–º–ø–∞–Ω–∏–∏-–ø–∞—Ä—Ç–Ω–µ—Ä–∞""",
        "info_school": """üéì –ù–∞—á–∞–ª—å–Ω–∞—è —à–∫–æ–ª–∞ ¬´–ê–∫–∞–¥–µ–º–∏—è¬ª

üìç –ê–¥—Ä–µ—Å: –≥. –ê—Å—Ç–∞–Ω–∞, —É–ª. –®—ã–≥–∞–Ω–∞–∫, 7
üìû –¢–µ–ª–µ—Ñ–æ–Ω—ã: +7 701 573 1794, +7 701 511 8396

üìö –ö–ª–∞—Å—Å—ã: —Å 1 –ø–æ 4
üìñ –ü—Ä–æ–≥—Ä–∞–º–º–∞: –∫–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–∞—è
üó£ –Ø–∑—ã–∫–∏ –æ–±—É—á–µ–Ω–∏—è: –∫–∞–∑–∞—Ö—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π
üë• –î–æ 15 –¥–µ—Ç–µ–π –≤ –∫–ª–∞—Å—Å–µ
üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—è —Å –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–π –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
üè• –ï—Å—Ç—å –º–µ–¥–∫–∞–±–∏–Ω–µ—Ç –∏ –º–µ–¥—Å–µ—Å—Ç—Ä–∞
üö´ –®–∫–æ–ª—å–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –Ω–µ—Ç""",
        "cost_school": """üí∞ –ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞: 260 000 —Ç–µ–Ω–≥–µ
üí≥ –ì–æ–¥–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞: 2 340 000 —Ç–µ–Ω–≥–µ
üíµ –í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å: 170 000 —Ç–µ–Ω–≥–µ (—Ä–∞–∑–æ–≤—ã–π)

üí∏ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, —Ñ–æ—Ä–º–∞

üéÅ –°–∫–∏–¥–∫–∏:
‚Ä¢ –í—Ç–æ—Ä–æ–π —Ä–µ–±—ë–Ω–æ–∫ ‚Äî 5%
‚Ä¢ –û–ø–ª–∞—Ç–∞ –∑–∞ –≥–æ–¥ –≤–ø–µ—Ä—ë–¥ ‚Äî 5%

‚è∞ –ü—Ä–æ–¥–ª—ë–Ω–∫–∞ –¥–æ 18:00 ‚Äî 2000 —Ç–µ–Ω–≥–µ/—á–∞—Å
üí≥ –û–ø–ª–∞—Ç–∞: —Ç–æ–ª—å–∫–æ –±–µ–∑–Ω–∞–ª–∏—á–Ω–∞—è
üìû –ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –æ–ø–ª–∞—Ç—ã: +7 701 577-41-88 (–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è)""",
        "enroll_school": """üìù –ü—Ä–∏–Ω–∏–º–∞–µ–º —Å 6 –ª–µ—Ç
‚úÖ –ï—Å—Ç—å –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
üìÖ –ù–∞–±–æ—Ä —Å 1 –∞–ø—Ä–µ–ª—è, –º–æ–∂–Ω–æ –ø–æ—Å—Ç—É–ø–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –≥–æ–¥–∞

üìÑ –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–æ–∫—É–º–µ–Ω—Ç: –ø–∞—Å–ø–æ—Ä—Ç –∑–¥–æ—Ä–æ–≤—å—è —Ä–µ–±—ë–Ω–∫–∞

üéØ –•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ? –ù–∞–ø–∏—à–∏—Ç–µ ¬´–î–∞¬ª""",
        "regime_school": """‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 08:00 ‚Äì 17:00 (–ø–Ω‚Äì–ø—Ç)
üìÖ –°—É–±–±–æ—Ç–∞ ‚Äî –≤—ã—Ö–æ–¥–Ω–æ–π
üìñ –£—Ä–æ–∫: 45 –º–∏–Ω—É—Ç, 6 —É—Ä–æ–∫–æ–≤ –≤ –¥–µ–Ω—å
‚è∞ –ü—Ä–æ–¥–ª—ë–Ω–∫–∞ –¥–æ 18:00 ‚Äî 2000 —Ç–µ–Ω–≥–µ/—á–∞—Å""",
        "food_school": """üçΩ 4-—Ä–∞–∑–æ–≤–æ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ
‚úÖ –í–∫–ª—é—á–µ–Ω–æ –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å
ü•ó –í–æ–∑–º–æ–∂–Ω–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –º–µ–Ω—é (–∞–ª–ª–µ—Ä–≥–∏–∏, —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)""",
        "circles_school": """üé® –ö—Ä—É–∂–∫–∏ –∏ —Å–µ–∫—Ü–∏–∏:

üé® –ê—Ä—Ç-—Å—Ç—É–¥–∏—è
üíÉ –°–ø–æ—Ä—Ç–∏–≤–Ω–æ-–±–∞–ª—å–Ω—ã–µ —Ç–∞–Ω—Ü—ã
ü•ã –ö–∞—Ä–∞—Ç—ç
ü§∏ –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞
üëÑ –õ–æ–≥–æ–ø–µ–¥
üßÆ –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞
‚ôü –®–∞—Ö–º–∞—Ç—ã
üé≠ –ê–∫—Ç—ë—Ä—Å–∫–æ–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ
üé§ –í–æ–∫–∞–ª
üéπ –§–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ
üß† –ü—Å–∏—Ö–æ–ª–æ–≥
üí™ –õ–§–ö –∏ –º–∞—Å—Å–∞–∂""",
        "feedbackAsk": "üìù –û–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ/–∑–∞–º–µ—á–∞–Ω–∏–µ:",
        "feedbackDone": "‚úÖ –°–ø–∞—Å–∏–±–æ! –í–∞—à –æ—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.",
        "enrollRequest": "üìù –ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–º—è —Ä–µ–±—ë–Ω–∫–∞ –∏ –≤–∞—à –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω:",
        "thanks": "‚úÖ –°–ø–∞—Å–∏–±–æ! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞.\n\nüìã –ù–æ–º–µ—Ä –∑–∞—è–≤–∫–∏: ",
        "phoneWarning": "‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
        "afterHours": "\n\n‚è∞ –°–µ–π—á–∞—Å –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (8:00-18:00)."
    },
    "kz": {
        "start": "üëã –°”ô–ª–µ–º–µ—Ç—Å—ñ–∑ –±–µ! ¬´–ê–∫–∞–¥–µ–º–∏—è¬ª –±—ñ–ª—ñ–º –±–µ—Ä—É “±–π—ã–º—ã–Ω–∞ “õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑!\n\nüì± –ë—ñ–∑ –±“±–ª —á–∞—Ç—Ç—ã —Ç–µ–∫ —Å—ñ–∑–±–µ–Ω “õ–∞—Ä—ã–º-“õ–∞—Ç—ã–Ω–∞—Å “Ø—à—ñ–Ω –ø–∞–π–¥–∞–ª–∞–Ω–∞–º—ã–∑. –î–µ—Ä–µ–∫—Ç–µ—Ä—ñ“£—ñ–∑ “õ–æ—Ä“ì–∞–ª“ì–∞–Ω.",
        "lang": "–¢—ñ–ª–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑:",
        "kg": "üè´ –ë–∞–ª–∞–±–∞“õ—à–∞",
        "school": "üéì –ë–∞—Å—Ç–∞—É—ã—à –º–µ–∫—Ç–µ–ø",
        "back": "‚óÄÔ∏è –ê—Ä—Ç“õ–∞",
        "restart": "üîÑ “ö–∞–π—Ç–∞ –±–∞—Å—Ç–∞—É",
        "menu": "–¢–∞“õ—ã—Ä—ã–ø—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑:",
        "items": [
            "üìã –ñ–∞–ª–ø—ã –∞“õ–ø–∞—Ä–∞—Ç",
            "üí∞ –ë–∞“ì–∞—Å—ã –º–µ–Ω —Ç”©–ª–µ–º",
            "üìù “ö–∞–±—ã–ª–¥–∞—É",
            "‚è∞ –ñ“±–º—ã—Å —Ç”ô—Ä—Ç—ñ–±—ñ",
            "üçΩ –¢–∞–º–∞“õ—Ç–∞–Ω—É",
            "üé® “ö–æ—Å—ã–º—à–∞ —Å–∞–±–∞“õ—Ç–∞—Ä",
            "üìû –ü—ñ–∫—ñ—Ä/“±—Å—ã–Ω—ã—Å “õ–∞–ª–¥—ã—Ä—É"
        ],
        "notUnderstood": "–ö–µ—à—ñ—Ä—ñ“£—ñ–∑, —Ç“Ø—Å—ñ–Ω–±–µ–¥—ñ–º. –¢”©–º–µ–Ω–¥–µ–≥—ñ –º”ô–∑—ñ—Ä–¥—ñ –ø–∞–π–¥–∞–ª–∞–Ω—ã“£—ã–∑ üëá",
        "operator": "üìû –û–ø–µ—Ä–∞—Ç–æ—Ä“ì–∞ “õ–æ“£—ã—Ä–∞—É —à–∞–ª—É “Ø—à—ñ–Ω:\n+7 701 573 1794\n\n–ù–µ–º–µ—Å–µ ”©—Ç—ñ–Ω—ñ—à “õ–∞–ª–¥—ã—Ä—ã“£—ã–∑, –±—ñ–∑ “õ–∞–π—Ç–∞ “õ–æ“£—ã—Ä–∞—É —à–∞–ª–∞–º—ã–∑.",
        "info_kg": """üè´ ¬´–ê–∫–∞–¥–µ–º–∏—è¬ª –º–µ–∫—Ç–µ–ø–∫–µ –¥–µ–π—ñ–Ω–≥—ñ –±—ñ–ª—ñ–º –±–µ—Ä—É “±–π—ã–º—ã

üìç –ú–µ–∫–µ–Ω–∂–∞–π—ã: –ê—Å—Ç–∞–Ω–∞ “õ., –®—ã“ì–∞–Ω–∞“õ –∫., 7
üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 701 573 1794, +7 708 685 3959

üë∂ –ñ–∞—Å —Ç–æ–ø—Ç–∞—Ä—ã: 2-3 –∂–∞—Å, 3-4 –∂–∞—Å, 4-5 –∂–∞—Å, 5-6 –∂–∞—Å, 6+ (–º–µ–∫—Ç–µ–ø–∞–ª–¥—ã –¥–∞–π—ã–Ω–¥—ã“õ)
üó£ –¢—ñ–ª–¥–µ—Ä: –º–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ –∂”ô–Ω–µ –æ—Ä—ã—Å
üìö ”ò–¥—ñ—Å—Ç–µ–º–µ–ª–µ—Ä: “ö–† —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã, –û—Ä—Ñ-–ø–µ–¥–∞–≥–æ–≥–∏–∫–∞, ¬´–ñ–∞—Å—ã–ª –±–∞–ª–∞–±–∞“õ—à–∞¬ª

üë• –¢–æ–ø—Ç–∞ 25 –±–∞–ª–∞“ì–∞ –¥–µ–π—ñ–Ω (1 —Ç”ô—Ä–±–∏–µ—à—ñ + 1 –∫”©–º–µ–∫—à—ñ)
‚úÖ –ë–∞—Ä: –ª–æ–≥–æ–ø–µ–¥, –ø—Å–∏—Ö–æ–ª–æ–≥, –º–µ–¥–±–∏–∫–µ, –ø–µ–¥–∏–∞—Ç—Ä
üç≥ ”®–∑ –∞—Å—Ö–∞–Ω–∞—Å—ã, ”ô—Ä —Ç–æ–ø—Ç—ã“£ ”©–∑ –∞–ª–∞“£—ã
üìπ –ë–µ–π–Ω–µ–±–∞“õ—ã–ª–∞—É –±–∞—Ä (–æ–Ω–ª–∞–π–Ω –∫”©—Ä—É –∂–æ“õ)""",
        "cost_kg": """üí∞ –ê–π —Å–∞–π—ã–Ω“ì—ã —Ç”©–ª–µ–º: 215 000 —Ç–µ“£–≥–µ
üí≥ –ö—ñ—Ä—É –∂–∞—Ä–Ω–∞—Å—ã: 150 000 —Ç–µ“£–≥–µ (–±—ñ—Ä —Ä–µ—Ç)

‚úÖ –ö—ñ—Ä–µ–¥—ñ:
‚Ä¢ –±–∞–ª–∞–Ω—ã –¥–∞–º—ã—Ç—É –±–∞“ì–¥–∞—Ä–ª–∞–º–∞—Å—ã
‚Ä¢ 5 –º–µ–∑–≥—ñ–ª —Ç–∞–º–∞“õ
‚Ä¢ –ê–ø—Ç–∞—Å—ã–Ω–∞ 20+ –¥–∞–º—ã—Ç—É —Å–∞–±–∞“ì—ã
‚Ä¢ –ñ“Ø–∑—É
‚Ä¢ –ë–∞—Ä–ª—ã“õ –º–∞—Ç–µ—Ä–∏–∞–ª–¥–∞—Ä

üí∏ “ö–æ—Å—ã–º—à–∞ —à—ã“ì—ã–Ω–¥–∞—Ä: –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å, —Å—ã—Ä—Ç“õ—ã —ñ—Å-—à–∞—Ä–∞–ª–∞—Ä, –±–∞–π“õ–∞—É–ª–∞—Ä, –∂–µ–∫–µ –º–µ—Ä–µ–∫–µ

üéÅ –ñ–µ“£—ñ–ª–¥—ñ–∫—Ç–µ—Ä:
‚Ä¢ –ï–∫—ñ–Ω—à—ñ –±–∞–ª–∞ ‚Äî 10 000 —Ç–µ“£–≥–µ –∫–µ–º
‚Ä¢ –ñ—ã–ª–¥—ã“õ —Ç”©–ª–µ–º ‚Äî 5%

üí≥ –¢”©–ª–µ–º: —Ç–µ–∫ “õ–æ–ª–º–∞-“õ–æ–ª –∞“õ—à–∞—Å—ã–∑
üìû –¢”©–ª–µ–º –±–æ–π—ã–Ω—à–∞: +7 701 577-41-88 (–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è)""",
        "enroll_kg": """üìù 2 –∂–∞—Å—Ç–∞–Ω –±–∞—Å—Ç–∞–ø “õ–∞–±—ã–ª–¥–∞–π–º—ã–∑
üìÖ –ñ—ã–ª –±–æ–π—ã –∂–∏–Ω–∞—É
‚è± –ü—Å–∏—Ö–æ–ª–æ–≥ –ø–µ–Ω –ø–µ–¥–∏–∞—Ç—Ä –ø–∞—Ç—Ä–æ–Ω–∞–∂—ã–º–µ–Ω –±–µ–π—ñ–º–¥–µ–ª—É –∫–µ–∑–µ“£—ñ

üìÑ “ö–∞–∂–µ—Ç—Ç—ñ “õ“±–∂–∞—Ç—Ç–∞—Ä:
1Ô∏è‚É£ ”®—Ç—ñ–Ω—ñ—à –∂”ô–Ω–µ –∞–Ω–∫–µ—Ç–∞ (–∫–µ“£—Å–µ–¥–µ —Ç–æ–ª—Ç—ã—Ä—ã–ª–∞–¥—ã)
2Ô∏è‚É£ –¢—É—É —Ç—É—Ä–∞–ª—ã –∫—É”ô–ª—ñ–∫—Ç—ñ“£ –∫”©—à—ñ—Ä–º–µ—Å—ñ
3Ô∏è‚É£ –ê—Ç–∞-–∞–Ω–∞–Ω—ã“£ –∫—É”ô–ª—ñ–≥—ñ–Ω—ñ“£ –∫”©—à—ñ—Ä–º–µ—Å—ñ
4Ô∏è‚É£ –§–æ—Ç–æ 3√ó4 ‚Äî 2 –¥–∞–Ω–∞
5Ô∏è‚É£ –î–µ–Ω—Å–∞—É–ª—ã“õ –ø–∞—Å–ø–æ—Ä—Ç—ã + ‚Ññ063 –Ω—ã—Å–∞–Ω—ã
6Ô∏è‚É£ –®–∞—Ä—Ç –∂”ô–Ω–µ –µ—Ä–µ–∂–µ–ª–µ—Ä (–∫–µ“£—Å–µ–¥–µ “õ–æ–ª “õ–æ–π—ã–ª–∞–¥—ã)

üéØ –≠–∫—Å–∫—É—Ä—Å–∏—è“ì–∞ –∂–∞–∑—ã–ª“ì—ã“£—ã–∑ –∫–µ–ª–µ –º–µ? ¬´–ò”ô¬ª –¥–µ–ø –∂–∞–∑—ã“£—ã–∑""",
        "regime_kg": """‚è∞ –ñ“±–º—ã—Å —Ä–µ–∂–∏–º—ñ: 08:00 ‚Äì 18:00 (–¥—Å‚Äì–∂–º)
üìÖ –î–µ–º–∞–ª—ã—Å –∫“Ø–Ω–¥–µ—Ä—ñ: —Å–µ–Ω–±—ñ, –∂–µ–∫—Å–µ–Ω–±—ñ
‚úÖ –ö“Ø–Ω–¥–µ–ª—ñ–∫—Ç—ñ –±–∞—Ä—É

‚ö†Ô∏è “ö–∞–ª—É–ª–∞—Ä:
‚Ä¢ –ê—É—Ä—É –±–æ–π—ã–Ω—à–∞ (–∞–Ω—ã“õ—Ç–∞–º–∞–º–µ–Ω) ‚Äî —Ç–∞–º–∞“õ –±–æ–π—ã–Ω—à–∞ 50% “õ–∞–π—Ç–∞ –µ—Å–µ–ø—Ç–µ—É
‚Ä¢ –î–µ–º–∞–ª—ã—Å ‚Äî —Ç–µ–∫ –±—ñ—Ä—ñ–Ω—à—ñ –∞–π–¥–∞ 50%, –æ–¥–∞–Ω ”ô—Ä—ñ —Ç–æ–ª—ã“õ —Ç”©–ª–µ–º""",
        "food_kg": """üçΩ 5 –º–µ–∑–≥—ñ–ª —Ç–µ“£–¥–µ—Å—Ç—ñ—Ä—ñ–ª–≥–µ–Ω —Ç–∞–º–∞“õ
üë®‚Äçüç≥ –ù—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥ –ø–µ–Ω –¥–∏–µ—Ç–æ–ª–æ–≥ –±–∞“õ—ã–ª–∞—É—ã–Ω–¥–∞ ”©–∑ –∞—Å—Ö–∞–Ω–∞–º—ã–∑–¥–∞ ”ô–∑—ñ—Ä–ª–µ–π–º—ñ–∑
ü•ó –ë–∞–ª–∞–ª–∞—Ä–¥—ã“£ –∂–µ–∫–µ “õ–∞–∂–µ—Ç—Ç—ñ–ª—ñ–∫—Ç–µ—Ä—ñ–Ω –µ—Å–∫–µ—Ä–µ–º—ñ–∑
üìã –¢–∞–º–∞“õ—Ç–∞–Ω—É “õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–≥—ñ –∂“Ø–π–µ—Å—ñ –µ–Ω–≥—ñ–∑—ñ–ª–≥–µ–Ω""",
        "circles_kg": """üé® “ö–æ—Å—ã–º—à–∞ —Å–∞–±–∞“õ—Ç–∞—Ä (“õ“±–Ω“ì–∞ –∫—ñ—Ä–µ–¥—ñ):

üèä –ñ“Ø–∑—É
üó£ –ê“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ
üé® –ê—Ä—Ç-—Å—Ç—É–¥–∏—è
üíÉ –°–ø–æ—Ä—Ç—Ç—ã“õ-–±–∞–ª—å–¥—ã“õ –±–∏–ª–µ—Ä ¬´S Dance¬ª
ü•ã –ö–∞—Ä–∞—Ç—ç
ü§∏ –ö”©—Ä–∫–µ–º –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞
üëÑ –õ–æ–≥–æ–ø–µ–¥
üßÆ –ú–µ–Ω—Ç–∞–ª—å–¥—ñ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞
‚ôü –®–∞—Ö–º–∞—Ç
üé≠ –ê–∫—Ç–µ—Ä–ª—ñ–∫ —à–µ–±–µ—Ä–ª—ñ–∫
üé§ –í–æ–∫–∞–ª –∂”ô–Ω–µ —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ
üß† –ü—Å–∏—Ö–æ–ª–æ–≥
üí™ –õ–§–ö –∂”ô–Ω–µ –º–∞—Å—Å–∞–∂

üéâ –ú–µ—Ä–µ–∫–µ–ª–µ—Ä (–±–∞–ª–∞–ª–∞—Ä–¥—ã“£ —Ç—É“ì–∞–Ω –∫“Ø–Ω–¥–µ—Ä—ñ) –∞—Ç–∞-–∞–Ω–∞–Ω—ã“£ —Å“±—Ä–∞–Ω—ã—Å—ã –±–æ–π—ã–Ω—à–∞ —Å–µ—Ä—ñ–∫—Ç–µ—Å –∫–æ–º–ø–∞–Ω–∏—è–Ω—ã“£ –±”©–ª–µ–∫ –ø—Ä–∞–π—Å—ã –±–æ–π—ã–Ω—à–∞ ”©—Ç–∫—ñ–∑—ñ–ª–µ–¥—ñ""",
        "info_school": """üéì ¬´–ê–∫–∞–¥–µ–º–∏—è¬ª –±–∞—Å—Ç–∞—É—ã—à –º–µ–∫—Ç–µ–±—ñ

üìç –ú–µ–∫–µ–Ω–∂–∞–π—ã: –ê—Å—Ç–∞–Ω–∞ “õ., –®—ã“ì–∞–Ω–∞“õ –∫., 7
üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 701 573 1794, +7 701 511 8396

üìö –°—ã–Ω—ã–ø—Ç–∞—Ä: 1-–¥–µ–Ω 4-–∫–µ –¥–µ–π—ñ–Ω
üìñ –ë–∞“ì–¥–∞—Ä–ª–∞–º–∞: “õ–∞–∑–∞“õ—Å—Ç–∞–Ω–¥—ã“õ
üó£ –û“õ—ã—Ç—É —Ç—ñ–ª–¥–µ—Ä—ñ: “õ–∞–∑–∞“õ –∂”ô–Ω–µ –æ—Ä—ã—Å
üë• –°—ã–Ω—ã–ø—Ç–∞ 15 –±–∞–ª–∞“ì–∞ –¥–µ–π—ñ–Ω
üë®‚Äçüè´ –ê—Ä–Ω–∞–π—ã –±—ñ–ª—ñ–∫—Ç—ñ–ª—ñ–≥—ñ –±–∞—Ä –º“±“ì–∞–ª—ñ–º–¥–µ—Ä
üè• –ú–µ–¥–∫–∞–±–∏–Ω–µ—Ç –ø–µ–Ω –º–µ–¥–±–∏–∫–µ –±–∞—Ä
üö´ –ú–µ–∫—Ç–µ–ø –∫”©–ª—ñ–≥—ñ –∂–æ“õ""",
        "cost_school": """üí∞ –ê–π —Å–∞–π—ã–Ω“ì—ã —Ç”©–ª–µ–º: 260 000 —Ç–µ“£–≥–µ
üí≥ –ñ—ã–ª–¥—ã“õ —Ç”©–ª–µ–º: 2 340 000 —Ç–µ–Ω–≥–µ
üíµ –ö—ñ—Ä—É –∂–∞—Ä–Ω–∞—Å—ã: 170 000 —Ç–µ“£–≥–µ (–±—ñ—Ä —Ä–µ—Ç)

üí∏ “ö–æ—Å—ã–º—à–∞ —à—ã“ì—ã–Ω–¥–∞—Ä: –æ“õ—É –º–∞—Ç–µ—Ä–∏–∞–ª–¥–∞—Ä—ã, —Ñ–æ—Ä–º–∞

üéÅ –ñ–µ“£—ñ–ª–¥—ñ–∫—Ç–µ—Ä:
‚Ä¢ –ï–∫—ñ–Ω—à—ñ –±–∞–ª–∞ ‚Äî 5%
‚Ä¢ –ñ—ã–ª–¥—ã“õ —Ç”©–ª–µ–º ‚Äî 5%

‚è∞ 18:00-–≥–µ –¥–µ–π—ñ–Ω “±–∑–∞—Ä—Ç—É ‚Äî 2000 —Ç–µ“£–≥–µ/—Å–∞“ì–∞—Ç
üí≥ –¢”©–ª–µ–º: —Ç–µ–∫ “õ–æ–ª–º–∞-“õ–æ–ª –∞“õ—à–∞—Å—ã–∑
üìû –¢”©–ª–µ–º –±–æ–π—ã–Ω—à–∞: +7 701 577-41-88 (–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è)""",
        "enroll_school": """üìù 6 –∂–∞—Å—Ç–∞–Ω –±–∞—Å—Ç–∞–ø “õ–∞–±—ã–ª–¥–∞–π–º—ã–∑
‚úÖ –ö—ñ—Ä—É —Ç–µ—Å—Ç—ñ–ª–µ—É—ñ –±–∞—Ä
üìÖ 1 —Å”ô—É—ñ—Ä–¥–µ–Ω –∂–∏–Ω–∞—É, –∂—ã–ª —ñ—à—ñ–Ω–¥–µ —Ç“Ø—Å—É–≥–µ –±–æ–ª–∞–¥—ã

üìÑ “ö–∞–∂–µ—Ç—Ç—ñ “õ“±–∂–∞—Ç: –±–∞–ª–∞–Ω—ã“£ –¥–µ–Ω—Å–∞—É–ª—ã“õ –ø–∞—Å–ø–æ—Ä—Ç—ã

üéØ –¢–µ—Å—Ç—ñ–ª–µ—É–≥–µ –∂–∞–∑—ã–ª“ì—ã“£—ã–∑ –∫–µ–ª–µ –º–µ? ¬´–ò”ô¬ª –¥–µ–ø –∂–∞–∑—ã“£—ã–∑""",
        "regime_school": """‚è∞ –ñ“±–º—ã—Å —Ä–µ–∂–∏–º—ñ: 08:00 ‚Äì 17:00 (–¥—Å‚Äì–∂–º)
üìÖ –°–µ–Ω–±—ñ ‚Äî –¥–µ–º–∞–ª—ã—Å
üìñ –°–∞–±–∞“õ: 45 –º–∏–Ω—É—Ç, –∫“Ø–Ω—ñ–Ω–µ 6 —Å–∞–±–∞“õ
‚è∞ 18:00-–≥–µ –¥–µ–π—ñ–Ω “±–∑–∞—Ä—Ç—É ‚Äî 2000 —Ç–µ“£–≥–µ/—Å–∞“ì–∞—Ç""",
        "food_school": """üçΩ 4 –º–µ–∑–≥—ñ–ª —Ç–µ“£–¥–µ—Å—Ç—ñ—Ä—ñ–ª–≥–µ–Ω —Ç–∞–º–∞“õ
‚úÖ “ö“±–Ω“ì–∞ –∫—ñ—Ä–µ–¥—ñ
ü•ó –ñ–µ–∫–µ –º”ô–∑—ñ—Ä –º“Ø–º–∫—ñ–Ω (–∞–ª–ª–µ—Ä–≥–∏—è, –¥—ñ–Ω–∏ —à–µ–∫—Ç–µ—É–ª–µ—Ä)""",
        "circles_school": """üé® “Æ–π—ñ—Ä–º–µ–ª–µ—Ä –º–µ–Ω —Å–µ–∫—Ü–∏—è–ª–∞—Ä:

üé® –ê—Ä—Ç-—Å—Ç—É–¥–∏—è
üíÉ –°–ø–æ—Ä—Ç—Ç—ã“õ-–±–∞–ª—å–¥—ã“õ –±–∏–ª–µ—Ä
ü•ã –ö–∞—Ä–∞—Ç—ç
ü§∏ –ö”©—Ä–∫–µ–º –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞
üëÑ –õ–æ–≥–æ–ø–µ–¥
üßÆ –ú–µ–Ω—Ç–∞–ª—å–¥—ñ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞
‚ôü –®–∞—Ö–º–∞—Ç
üé≠ –ê–∫—Ç–µ—Ä–ª—ñ–∫ —à–µ–±–µ—Ä–ª—ñ–∫
üé§ –í–æ–∫–∞–ª
üéπ –§–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ
üß† –ü—Å–∏—Ö–æ–ª–æ–≥
üí™ –õ–§–ö –∂”ô–Ω–µ –º–∞—Å—Å–∞–∂""",
        "feedbackAsk": "üìù “∞—Å—ã–Ω—ã—Å—ã“£—ã–∑–¥—ã/–µ—Å–∫–µ—Ä—Ç—É—ñ“£—ñ–∑–¥—ñ —Å–∏–ø–∞—Ç—Ç–∞“£—ã–∑:",
        "feedbackDone": "‚úÖ –†–∞“õ–º–µ—Ç! –ü—ñ–∫—ñ—Ä—ñ“£—ñ–∑ “õ–∞–±—ã–ª–¥–∞–Ω–¥—ã. –ñ–∞“õ—ã–Ω –∞—Ä–∞–¥–∞ —Å—ñ–∑–±–µ–Ω —Ö–∞–±–∞—Ä–ª–∞—Å–∞–º—ã–∑.",
        "enrollRequest": "üìù –ë–∞–ª–∞–Ω—ã“£ –∞—Ç—ã–Ω –∂”ô–Ω–µ –±–∞–π–ª–∞–Ω—ã—Å —Ç–µ–ª–µ—Ñ–æ–Ω—ã–Ω –∂–∞–∑—ã“£—ã–∑:",
        "thanks": "‚úÖ –†–∞“õ–º–µ—Ç! ”®—Ç—ñ–Ω—ñ—à “õ–∞–±—ã–ª–¥–∞–Ω–¥—ã.\n\nüìã ”®—Ç—ñ–Ω—ñ—à –Ω”©–º—ñ—Ä—ñ: ",
        "phoneWarning": "‚ö†Ô∏è –¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ–Ω –∫”©—Ä—Å–µ—Ç—ñ“£—ñ–∑",
        "afterHours": "\n\n‚è∞ “ö–∞–∑—ñ—Ä –∂“±–º—ã—Å —É–∞“õ—ã—Ç—ã –µ–º–µ—Å. –ë—ñ–∑ —Å—ñ–∑–±–µ–Ω –∂“±–º—ã—Å —É–∞“õ—ã—Ç—ã–Ω–¥–∞ (8:00-18:00) —Ö–∞–±–∞—Ä–ª–∞—Å–∞–º—ã–∑."
    }
}


def get_user_state(sender: str) -> Dict:
    if redis_client:
        try:
            data = redis_client.get(f"user:{sender}")
            if data:
                state = json.loads(data)
                last_activity = datetime.fromisoformat(state['lastActivity'])
                if datetime.now() - last_activity > timedelta(seconds=SESSION_TIMEOUT_SECONDS):
                    return create_default_state()
                return state
        except Exception as e:
            print(f"Redis GET error: {e}")
    return create_default_state()


def set_user_state(sender: str, state: Dict):
    if redis_client:
        try:
            state['lastActivity'] = datetime.now().isoformat()
            redis_client.setex(f"user:{sender}", SESSION_TIMEOUT_SECONDS, json.dumps(state))
        except Exception as e:
            print(f"Redis SET error: {e}")


def create_default_state() -> Dict:
    return {
        'lang': 'ru',
        'step': 'start',
        'org': None,
        'prevStep': None,
        'lastActivity': datetime.now().isoformat(),
        'isFirstVisit': True
    }


def send_message(chat_id: str, text: str) -> Optional[Dict]:
    final_chat_id = chat_id if '@' in chat_id else f"{chat_id}@c.us"
    url = f"https://api.green-api.com/waInstance{GREEN_INSTANCE}/sendMessage/{GREEN_TOKEN}"
    
    max_retries = 3
    for attempt in range(max_retries):
        try:
            response = requests.post(url, json={"chatId": final_chat_id, "message": text}, timeout=8)
            if response.status_code == 200:
                result = response.json()
                print(f"‚úÖ Message sent: {result}")
                return result
            else:
                print(f"‚ö†Ô∏è Failed: {response.status_code}")
        except Exception as e:
            print(f"‚ùå Error: {e}")
        if attempt < max_retries - 1:
            import time
            time.sleep(0.5)
    return None


def send_telegram(text: str):
    if not TELEGRAM_TOKEN or not ADMIN_TELEGRAM:
        print('‚ö†Ô∏è Telegram disabled')
        return
    try:
        response = requests.post(
            f"https://api.telegram.org/bot{TELEGRAM_TOKEN}/sendMessage",
            json={"chat_id": ADMIN_TELEGRAM, "text": text, "parse_mode": "HTML"},
            timeout=5
        )
        if response.status_code == 200:
            print("‚úÖ Telegram sent")
    except Exception as e:
        print(f"‚ùå Telegram error: {e}")


def get_main_menu(lang: str) -> str:
    items = '\n'.join([f"{i+1}. {item}" for i, item in enumerate(t[lang]['items'])])
    return f"{items}\n\n0. {t[lang]['back']}\nüîÑ {t[lang]['restart']}"


def is_working_hours() -> bool:
    hour = datetime.now().hour
    return 8 <= hour < 18


def generate_request_id() -> str:
    return f"REQ{int(datetime.now().timestamp() * 1000)}"


def validate_phone(text: str) -> bool:
    return bool(re.search(r'\+?\d{10,}', text))



class handler(BaseHTTPRequestHandler):
    def do_POST(self):
        try:
            content_length = int(self.headers.get('Content-Length', 0))
            if content_length == 0:
                self.send_error(400, "Empty request")
                return
                
            post_data = self.rfile.read(content_length)
            body = json.loads(post_data.decode('utf-8'))
            
            print(f'üì• Webhook: {body.get("typeWebhook")}')
            
            if body.get('typeWebhook') != 'incomingMessageReceived':
                self.send_json_response({"ok": True})
                return
            
            sender_data = body.get('senderData', {})
            message_data = body.get('messageData', {})
            sender = sender_data.get('chatId')
            text = message_data.get('textMessageData', {}).get('textMessage', '').strip()
            
            if not sender or not text:
                self.send_json_response({"ok": True})
                return
            
            print(f'üë§ {sender}: {text[:50]}')
            
            self.process_message(sender, text, sender_data)
            self.send_json_response({"ok": True})
            
        except Exception as e:
            print(f'‚ùå Error: {e}')
            self.send_error(500, str(e))
    
    def process_message(self, sender: str, text: str, sender_data: Dict):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        lower = text.lower()
        state = get_user_state(sender)
        msg = ""
        
        # /start –∏–ª–∏ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
        if text == "/start" or "–Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ" in lower or "“õ–∞–π—Ç–∞ –±–∞—Å—Ç–∞—É" in lower or "üîÑ" in text:
            state = create_default_state()
            state['step'] = 'lang'
            state['isFirstVisit'] = False
            msg = f"{t['ru']['start']}\n\n{t['ru']['lang']}\n\n1. –†—É—Å—Å–∫–∏–π\n2. “ö–∞–∑–∞“õ—à–∞"
            send_message(sender, msg)
            set_user_state(sender, state)
            return
        
        # –û–ø–µ—Ä–∞—Ç–æ—Ä
        if "–æ–ø–µ—Ä–∞—Ç–æ—Ä" in lower or "—á–µ–ª–æ–≤–µ–∫" in lower or "–∞–¥–∞–º" in lower:
            msg = t[state['lang']]['operator']
            if state.get('org'):
                msg += f"\n\n{get_main_menu(state['lang'])}"
            send_message(sender, msg)
            set_user_state(sender, state)
            return
        
        # –ù–∞–∑–∞–¥
        if lower in ["–Ω–∞–∑–∞–¥", "–∞—Ä—Ç“õ–∞", "‚óÄÔ∏è –Ω–∞–∑–∞–¥", "‚óÄÔ∏è –∞—Ä—Ç“õ–∞"] or text == "0":
            if state['step'] in ['complaint', 'waiting_contact', 'enroll']:
                state['step'] = 'menu'
                org_key = state['org']
                msg = f"{t[state['lang']][org_key]}\n\n{t[state['lang']]['menu']}\n\n{get_main_menu(state['lang'])}"
            elif state['step'] == 'menu':
                state['step'] = 'choose_org'
                state['org'] = None
                msg = f"{t[state['lang']]['start']}\n\n–í—ã–±–µ—Ä–∏—Ç–µ:\n\n1. {t[state['lang']]['kg']}\n2. {t[state['lang']]['school']}\n\n0. {t[state['lang']]['back']}"
            elif state['step'] == 'choose_org':
                state['step'] = 'lang'
                msg = f"{t['ru']['start']}\n\n{t['ru']['lang']}\n\n1. –†—É—Å—Å–∫–∏–π\n2. “ö–∞–∑–∞“õ—à–∞"
            send_message(sender, msg)
            set_user_state(sender, state)
            return
        
        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        if state['step'] == 'start':
            name = sender_data.get('senderName', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å')
            msg = f"üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {name}!\n\n{t['ru']['start']}\n\n{t['ru']['lang']}\n\n1. –†—É—Å—Å–∫–∏–π\n2. “ö–∞–∑–∞“õ—à–∞"
            state['step'] = 'lang'
            state['isFirstVisit'] = False
        
        # –í—ã–±–æ—Ä —è–∑—ã–∫–∞
        elif state['step'] == 'lang':
            state['lang'] = 'kz' if ('“õ–∞–∑–∞“õ' in lower or text == '2') else 'ru'
            msg = f"{t[state['lang']]['start']}\n\n–í—ã–±–µ—Ä–∏—Ç–µ:\n\n1. {t[state['lang']]['kg']}\n2. {t[state['lang']]['school']}\n\n0. {t[state['lang']]['back']}"
            state['step'] = 'choose_org'
        
        # –í—ã–±–æ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
        elif state['step'] == 'choose_org':
            state['org'] = 'kg' if ('–±–∞–ª–∞–±–∞“õ—à–∞' in lower or '—Å–∞–¥' in lower or text == '1') else 'school'
            org_key = state['org']
            msg = f"{t[state['lang']][org_key]}\n\n{t[state['lang']]['menu']}\n\n{get_main_menu(state['lang'])}"
            state['step'] = 'menu'
        
        # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        elif state['step'] == 'menu':
            l = state['lang']
            is_kg = state['org'] == 'kg'
            
            if 'üìû' in text or text == '7' or '–æ—Ç–∑—ã–≤' in lower or '–ø—ñ–∫—ñ—Ä' in lower or '–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ' in lower or '“±—Å—ã–Ω—ã' in lower:
                msg = f"{t[l]['feedbackAsk']}\n\n0. {t[l]['back']}"  # ‚úÖ FIXED
                state['step'] = 'complaint'
            elif text == '1' or 'üìã' in text or '–æ–±—â–∞—è' in lower or '–∂–∞–ª–ø—ã' in lower:
                msg = f"{t[l]['info_kg' if is_kg else 'info_school']}\n\n{get_main_menu(l)}"
            elif text == '2' or 'üí∞' in text or '—Å—Ç–æ–∏–º–æ—Å—Ç—å' in lower or '–±–∞“ì–∞—Å' in lower:
                msg = f"{t[l]['cost_kg' if is_kg else 'cost_school']}\n\n{get_main_menu(l)}"
            elif text == '3' or 'üìù' in text or '–ø–æ—Å—Ç—É–ø–ª–µ–Ω' in lower or '“õ–∞–±—ã–ª–¥–∞—É' in lower:
                msg = f"{t[l]['enroll_kg' if is_kg else 'enroll_school']}\n\n–î–∞ / –ò”ô\n0. {t[l]['back']}"
                state['step'] = 'enroll'
            elif text == '4' or '‚è∞' in text or '—Ä–µ–∂–∏–º' in lower or '—Ç”ô—Ä—Ç—ñ–±' in lower:
                msg = f"{t[l]['regime_kg' if is_kg else 'regime_school']}\n\n{get_main_menu(l)}"
            elif text == '5' or 'üçΩ' in text or '–ø–∏—Ç–∞–Ω' in lower or '—Ç–∞–º–∞“õ' in lower:
                msg = f"{t[l]['food_kg' if is_kg else 'food_school']}\n\n{get_main_menu(l)}"
            elif text == '6' or 'üé®' in text or '–∫—Ä—É–∂–∫' in lower or '“Ø–π—ñ—Ä–º–µ' in lower:
                msg = f"{t[l]['circles_kg' if is_kg else 'circles_school']}\n\n{get_main_menu(l)}"
            else:
                msg = f"{t[l]['notUnderstood']}\n\n{get_main_menu(l)}"
        
        # –ñ–∞–ª–æ–±–∞/–û—Ç–∑—ã–≤
        elif state['step'] == 'complaint':
            org_name = ('–î–µ—Ç—Å–∫–∏–π —Å–∞–¥' if state['lang'] == 'ru' else '–ë–∞–ª–∞–±–∞“õ—à–∞') if state['org'] == 'kg' else ('–®–∫–æ–ª–∞' if state['lang'] == 'ru' else '–ú–µ–∫—Ç–µ–ø')
            now = datetime.now()
            
            telegram_msg = f"""üö® <b>–û–¢–ó–´–í/–ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï</b>
üìä {now.strftime('%d.%m.%Y %H:%M')}
üë§ {sender}
üè´ {org_name}
üó£ {'üá∑üá∫' if state['lang'] == 'ru' else 'üá∞üáø'}

        <b>–¢–µ–∫—Å—Ç:</b>
        {text}"""
            send_telegram(telegram_msg)
            
            state['step'] = 'menu'
            msg = f"{t[state['lang']]['feedbackDone']}\n\n{get_main_menu(state['lang'])}"  # ‚úÖ FIXED
        
        # –ó–∞–ø–∏—Å—å
        elif state['step'] == 'enroll':
            if '–¥–∞' in lower or '–∏”ô' in lower:
                msg = f"{t[state['lang']]['enrollRequest']}\n\n0. {t[state['lang']]['back']}"
                state['step'] = 'waiting_contact'
            else:
                state['step'] = 'menu'
                msg = f"{'–•–æ—Ä–æ—à–æ üòä' if state['lang'] == 'ru' else '–ñ–∞“õ—Å—ã üòä'}\n\n{get_main_menu(state['lang'])}"
        
        # –ö–æ–Ω—Ç–∞–∫—Ç—ã
        elif state['step'] == 'waiting_contact':
            if not validate_phone(text):
                msg = f"{t[state['lang']]['phoneWarning']}\n\n0. {t[state['lang']]['back']}"
            else:
                request_id = generate_request_id()
                org_name = ('–î–µ—Ç—Å–∫–∏–π —Å–∞–¥' if state['lang'] == 'ru' else '–ë–∞–ª–∞–±–∞“õ—à–∞') if state['org'] == 'kg' else ('–®–∫–æ–ª–∞' if state['lang'] == 'ru' else '–ú–µ–∫—Ç–µ–ø')
                
                telegram_msg = f"""üìù <b>–ó–ê–Ø–í–ö–ê</b>
üìä {datetime.now().strftime('%d.%m.%Y %H:%M')}
üë§ {sender}
üè´ {org_name}
üÜî {request_id}

<b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b>
{text}"""
                send_telegram(telegram_msg)
                
                state['step'] = 'menu'
                msg = t[state['lang']]['thanks'] + request_id
                if not is_working_hours():
                    msg += t[state['lang']]['afterHours']
                msg += f"\n\n{get_main_menu(state['lang'])}"
        
        else:
            msg = f"{t[state['lang']]['notUnderstood']}\n\n{get_main_menu(state['lang'])}"
        
        set_user_state(sender, state)
        if msg:
            send_message(sender, msg)
    
    def send_json_response(self, data: Dict):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ JSON –æ—Ç–≤–µ—Ç–∞"""
        self.send_response(200)
        self.send_header('Content-type', 'application/json')
        self.end_headers()
        self.wfile.write(json.dumps(data).encode())
    
    def do_GET(self):
        """Health check"""
        self.send_response(200)
        self.send_header('Content-type', 'application/json')
        self.end_headers()
        health = {
            "status": "ok",
            "redis": redis_client is not None,
            "timestamp": datetime.now().isoformat()
        }
        self.wfile.write(json.dumps(health).encode())